import{K as O,r as _,af as U,g as j,B as J,p as K,ao as Y}from"#entry";const G=O("productStore",()=>{const a=_({}),p=_(!1),d=_(null),B="https://api.streetstylestore.com",C="Bm23NaocNyDb2qWiT9Mpn4qXdSmq7bqdoLzY6espTB3MC6Rx",l=U(),z=(e,s={})=>{try{return JSON.parse(e)}catch{return s}},A=e=>e?.toString().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,""),g=async(e={})=>{p.value=!0,d.value=null;try{const{categoryId:s,page:n=1,perPage:m=30,city:v,idBrand:b,shop:P,type:S}=e,N=l?.params?.child||"",L=l?.params?.parent||"";let r=s;if(!r){const i=(N!=="all"?N:L).match(/(\d+)$/);r=i?i[1]:"default"}const c=[];r&&!isNaN(Number(r))&&c.push(`categories:=${r}`),v&&c.push(`deal_cities:=[${v}]`),b&&c.push(`id_brand:=${b}`),P&&c.push(`sss_shops:=[${P}]`),S&&c.push(`product_type:=${S}`);const R=c.join(","),T=encodeURIComponent(R),$=`${B}/collections/products/documents/search?q=*${c.length?"&filter_by="+T:""}&per_page=${m}&filter_by=active:=1&page=${n}`;console.log("ðŸ“¦ Fetching products from URL:",$);const f=await Y($,{method:"GET",headers:{"x-typesense-api-key":C},retry:1}),h=Array.isArray(f.hits)?f.hits.map(i=>{const t=i.document??i,y=t.product_data?z(t.product_data,{}):{},o=y[0]||{},F=(y.shoeSize||[]).map(u=>u.Size).filter(Boolean)||(t.product_all_sizes||[]).filter(Boolean)||["N/A"],M=o.categories?o.categories.split("^").map(u=>u.split("*")[0]):t.categories?.map(u=>u.toString())||[],q=t.product_id||o.id||t.id||`product-${Math.random().toString(36).substring(2,9)}`,x=A(t.name||o.name||q);return{id:String(q),displayName:o.name||t.name||"",displayPrice:Number(o.selling_price)||Number(t.real_selling_price)||Number(t.selling_price)||0,displayDiscount:Number(o.discount_price)||Number(t.discount_price)||0,sizes:F,displayCategories:M,tags:t.tags||[],slug:x,images:y.images||[{img:t.img}],quantity_available:o.product_quantity||t.quantity_available||0,rawData:t}}):[];a.value[r]||(a.value[r]={products:[],currentPage:1,total:0}),a.value[r].products=n===1?h:[...a.value[r].products,...h],a.value[r].currentPage=n,a.value[r].total=f.found||h.length}catch(s){console.error("âŒ Fetch error:",s),d.value=s?.message||"Failed to fetch products"}finally{p.value=!1}},I=e=>a.value[e]?.products||[],w=e=>a.value[e]?.currentPage||1,D=e=>a.value[e]?.total||0,E=j(()=>{const e=new Set;return Object.values(a.value).forEach(s=>{s.products.forEach(n=>n?.tags?.forEach(m=>e.add(m)))}),Array.from(e)});return J(()=>g()),K(()=>[l.params.parent,l.params.child],()=>g()),{productLists:a,loading:p,error:d,fetchProducts:g,getProductsByCategory:I,getCurrentPage:w,getTotalProducts:D,availableTags:E}});export{G as u};
