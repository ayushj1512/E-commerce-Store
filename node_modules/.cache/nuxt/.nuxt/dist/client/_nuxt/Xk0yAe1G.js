import{A as P,q as I,s as j,K as D}from"#entry";function U(t){return P()?(I(t),!0):!1}typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;var m={},_;function $(){if(_)return m;_=1,Object.defineProperty(m,"__esModule",{value:!0}),m.parse=d,m.serialize=E;const t=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,e=/^[\u0021-\u003A\u003C-\u007E]*$/,i=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,s=/^[\u0020-\u003A\u003D-\u007E]*$/,c=Object.prototype.toString,g=(()=>{const o=function(){};return o.prototype=Object.create(null),o})();function d(o,l){const r=new g,u=o.length;if(u<2)return r;const y=l?.decode||x;let n=0;do{const h=o.indexOf("=",n);if(h===-1)break;const O=o.indexOf(";",n),S=O===-1?u:O;if(h>S){n=o.lastIndexOf(";",h-1)+1;continue}const k=f(o,n,h),N=a(o,h,k),C=o.slice(k,N);if(r[C]===void 0){let A=f(o,h+1,S),T=a(o,S,A);const L=y(o.slice(A,T));r[C]=L}n=S+1}while(n<u);return r}function f(o,l,r){do{const u=o.charCodeAt(l);if(u!==32&&u!==9)return l}while(++l<r);return r}function a(o,l,r){for(;l>r;){const u=o.charCodeAt(--l);if(u!==32&&u!==9)return l+1}return r}function E(o,l,r){const u=r?.encode||encodeURIComponent;if(!t.test(o))throw new TypeError(`argument name is invalid: ${o}`);const y=u(l);if(!e.test(y))throw new TypeError(`argument val is invalid: ${l}`);let n=o+"="+y;if(!r)return n;if(r.maxAge!==void 0){if(!Number.isInteger(r.maxAge))throw new TypeError(`option maxAge is invalid: ${r.maxAge}`);n+="; Max-Age="+r.maxAge}if(r.domain){if(!i.test(r.domain))throw new TypeError(`option domain is invalid: ${r.domain}`);n+="; Domain="+r.domain}if(r.path){if(!s.test(r.path))throw new TypeError(`option path is invalid: ${r.path}`);n+="; Path="+r.path}if(r.expires){if(!v(r.expires)||!Number.isFinite(r.expires.valueOf()))throw new TypeError(`option expires is invalid: ${r.expires}`);n+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(n+="; HttpOnly"),r.secure&&(n+="; Secure"),r.partitioned&&(n+="; Partitioned"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():void 0){case"low":n+="; Priority=Low";break;case"medium":n+="; Priority=Medium";break;case"high":n+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${r.priority}`)}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:case"strict":n+="; SameSite=Strict";break;case"lax":n+="; SameSite=Lax";break;case"none":n+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${r.sameSite}`)}return n}function x(o){if(o.indexOf("%")===-1)return o;try{return decodeURIComponent(o)}catch{return o}}function v(o){return c.call(o)==="[object Date]"}return m}var p=$();function R(){const t=typeof global>"u"?void 0:global.TEST_HAS_DOCUMENT_COOKIE;return typeof t=="boolean"?t:typeof document=="object"&&typeof document.cookie=="string"}function z(t){return typeof t=="string"?p.parse(t):typeof t=="object"&&t!==null?t:{}}function b(t,e={}){const i=M(t);if(!e.doNotParse)try{return JSON.parse(i)}catch{}return t}function M(t){return t&&t[0]==="j"&&t[1]===":"?t.substr(2):t}class H{constructor(e,i={}){this.changeListeners=[],this.HAS_DOCUMENT_COOKIE=!1,this.update=()=>{if(!this.HAS_DOCUMENT_COOKIE)return;const c=this.cookies;this.cookies=p.parse(document.cookie),this._checkChanges(c)};const s=typeof document>"u"?"":document.cookie;this.cookies=z(e||s),this.defaultSetOptions=i,this.HAS_DOCUMENT_COOKIE=R()}_emitChange(e){for(let i=0;i<this.changeListeners.length;++i)this.changeListeners[i](e)}_checkChanges(e){new Set(Object.keys(e).concat(Object.keys(this.cookies))).forEach(s=>{e[s]!==this.cookies[s]&&this._emitChange({name:s,value:b(this.cookies[s])})})}_startPolling(){this.pollingInterval=setInterval(this.update,300)}_stopPolling(){this.pollingInterval&&clearInterval(this.pollingInterval)}get(e,i={}){return i.doNotUpdate||this.update(),b(this.cookies[e],i)}getAll(e={}){e.doNotUpdate||this.update();const i={};for(let s in this.cookies)i[s]=b(this.cookies[s],e);return i}set(e,i,s){s?s=Object.assign(Object.assign({},this.defaultSetOptions),s):s=this.defaultSetOptions;const c=typeof i=="string"?i:JSON.stringify(i);this.cookies=Object.assign(Object.assign({},this.cookies),{[e]:c}),this.HAS_DOCUMENT_COOKIE&&(document.cookie=p.serialize(e,c,s)),this._emitChange({name:e,value:i,options:s})}remove(e,i){const s=i=Object.assign(Object.assign(Object.assign({},this.defaultSetOptions),i),{expires:new Date(1970,1,1,0,0,1),maxAge:0});this.cookies=Object.assign({},this.cookies),delete this.cookies[e],this.HAS_DOCUMENT_COOKIE&&(document.cookie=p.serialize(e,"",s)),this._emitChange({name:e,value:void 0,options:i})}addChangeListener(e){this.changeListeners.push(e),this.HAS_DOCUMENT_COOKIE&&this.changeListeners.length===1&&(typeof window=="object"&&"cookieStore"in window?window.cookieStore.addEventListener("change",this.update):this._startPolling())}removeChangeListener(e){const i=this.changeListeners.indexOf(e);i>=0&&this.changeListeners.splice(i,1),this.HAS_DOCUMENT_COOKIE&&this.changeListeners.length===0&&(typeof window=="object"&&"cookieStore"in window?window.cookieStore.removeEventListener("change",this.update):this._stopPolling())}removeAllChangeListeners(){for(;this.changeListeners.length>0;)this.removeChangeListener(this.changeListeners[0])}}function w(t,{doNotParse:e=!1,autoUpdateDependencies:i=!1}={},s=new H){const c=i?[]:t;let g=s.getAll({doNotParse:!0});const d=j(0),f=()=>{const a=s.getAll({doNotParse:!0});V(c||null,a,g)&&d.value++,g=a};return s.addChangeListener(f),U(()=>{s.removeChangeListener(f)}),{get:(...a)=>(i&&c&&!c.includes(a[0])&&c.push(a[0]),d.value,s.get(a[0],{doNotParse:e,...a[1]})),getAll:(...a)=>(d.value,s.getAll({doNotParse:e,...a[0]})),set:(...a)=>s.set(...a),remove:(...a)=>s.remove(...a),addChangeListener:(...a)=>s.addChangeListener(...a),removeChangeListener:(...a)=>s.removeChangeListener(...a)}}function V(t,e,i){if(!t)return!0;for(const s of t)if(e[s]!==i[s])return!0;return!1}const q=D("auth",{state:()=>({key:null,id_customer:null,name:null,isAuthenticated:!1,loading:!1,error:null,mobileNumber:"",newCustomer:!1}),actions:{setCustomer(t){if(!t||!t.key){console.warn("[Auth Store] ‚ö†Ô∏è Invalid payload:",t);return}this.key=t.key,this.id_customer=t.id_customer,this.name=t.name,this.isAuthenticated=!0;const e=w();e.set("key",this.key,{path:"/",sameSite:"lax"}),e.set("id_customer",this.id_customer,{path:"/",sameSite:"lax"}),e.set("name",this.name,{path:"/",sameSite:"lax"}),console.log("[Auth Store] ‚úÖ Session persisted in cookies:",{key:this.key,id_customer:this.id_customer,name:this.name})},loadSession(){{const t=w();this.key=t.get("key")||null,this.id_customer=t.get("id_customer")||null,this.name=t.get("name")||null,this.isAuthenticated=!!this.key,console.log("[Auth Store] üîÑ Session loaded from cookies:",{key:this.key,id_customer:this.id_customer,name:this.name,isAuthenticated:this.isAuthenticated})}},initAuth(){console.log("[Auth Store] üöÄ Initializing auth..."),this.loadSession()},logout(){this.key=null,this.id_customer=null,this.name=null,this.isAuthenticated=!1;const t=w();t.remove("key"),t.remove("id_customer"),t.remove("name"),console.log("[Auth Store] ‚ùå Session cleared")},async sendLoginOTP(){this.loading=!0,this.error=null;try{console.log("[Auth Store] üì© Sending OTP for mobile:",this.mobileNumber);const t=await $fetch("http://localhost:4000/send-otp",{method:"POST",body:{mobileNumber:this.mobileNumber,site:"yourSiteName"}});return console.log("[Auth Store] üì© OTP Send Response:",t),t}catch(t){throw this.error=t?.data?.error||"Send OTP failed",console.error("[Auth Store] ‚ùå Send OTP Error:",t),t}finally{this.loading=!1}},async verifyOtp(t){this.loading=!0,this.error=null;try{console.log("[Auth Store] üì© Verifying OTP for mobile:",this.mobileNumber);const e=await $fetch("http://localhost:4000/verify-otp",{method:"POST",body:{mobileNumber:this.mobileNumber,otp:t,newCustomer:this.newCustomer,site:"yourSiteName"}});if(console.log("[Gateway Proxy] Response Status:",e.status),console.log("[Gateway Proxy] Response Data:",e),e.newUser)return this.newCustomer=!0,console.log("[Auth Store] üîπ New user detected, registration required"),{newUser:!0};const i={key:e.key,id_customer:e.id_customer,name:e.first_name||e.email||"User"};return this.setCustomer(i),console.log("[Auth Store] ‚úÖ OTP verified and session stored in cookies:",i),e}catch(e){throw this.error=e?.data?.error||"Verify OTP failed",console.error("[Auth Store] ‚ùå OTP Verify Error:",e),e}finally{this.loading=!1}},async loginWithPassword(t){this.loading=!0,this.error=null;try{console.log("[Auth Store] üì© Login with password for mobile:",this.mobileNumber);const e=await $fetch("http://localhost:4000/login-password",{method:"POST",body:{mobileNumber:this.mobileNumber,password:t,site:"yourSiteName"}});return this.setCustomer(e),console.log("[Auth Store] ‚úÖ Password login successful:",e),e}catch(e){throw this.error=e?.data?.error||"Login failed",console.error("[Auth Store] ‚ùå Login Error:",e),e}finally{this.loading=!1}},async register(t,e){this.loading=!0,this.error=null;try{console.log("[Auth Store] üì© Registering mobile:",this.mobileNumber);const i=await $fetch("http://localhost:4000/register",{method:"POST",body:{mobileNumber:this.mobileNumber,email:t,password:e,site:"yourSiteName",checkout:!1}});return this.setCustomer(i),console.log("[Auth Store] ‚úÖ Registration successful:",i),i}catch(i){throw this.error=i?.data?.error||"Register failed",console.error("[Auth Store] ‚ùå Register Error:",i),i}finally{this.loading=!1}}}});export{q as u};
