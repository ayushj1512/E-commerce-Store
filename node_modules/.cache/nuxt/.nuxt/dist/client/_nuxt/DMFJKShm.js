import{_ as k,r as d,B as w,c as o,o as r,a as t,b as C,F as m,E as _,t as l,J as h,w as T,C as D,U as j,V as R,T as S,O as x}from"#entry";import{u as N}from"./Xk0yAe1G.js";const F={class:"min-h-screen bg-white px-4 py-6"},M={key:0,class:"text-center py-10 text-gray-600"},V={key:1,class:"text-center py-10"},B={key:2,class:"space-y-4 max-w-3xl mx-auto"},J=["onClick"],O={class:"flex justify-between items-center mb-2"},q={class:"font-semibold text-black"},z={class:"text-gray-600 text-sm"},L={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},A={class:"bg-white rounded-2xl p-6 sm:p-8 md:p-10 max-w-2xl w-full shadow-xl overflow-y-auto max-h-[80vh]"},E={class:"text-xl sm:text-2xl font-bold mb-4"},P={class:"text-gray-600 text-sm mb-4"},U={class:"space-y-3 mb-4"},I={class:"text-sm"},Y={class:"text-xs text-gray-500 mt-1"},$={__name:"support",setup(G){const u=N(),i=d([]),p=d(!0),y=d(!1),n=d({}),c=d(""),v=async()=>{p.value=!0;try{if(!u.isAuthenticated){i.value=[];return}const a=JSON.stringify({gateway_action:"customer/support",action:"list",version:"1",id_customer:u.loginData.id_customer}),s=await x.post("https://gateway.streetstylestore.com/gateway/v1/",a,{headers:{"Content-Type":"application/json"},withCredentials:!0});console.log("Ticket List Response:",s.data),i.value=s.data?.tickets||[]}catch(a){console.error("Failed to fetch tickets:",a),i.value=[]}finally{p.value=!1}},g=async a=>{try{const s=JSON.stringify({gateway_action:"customer/support",action:"detail",version:"1",id_customer:u.loginData.id_customer,ticket_id:a}),e=await x.post("https://gateway.streetstylestore.com/gateway/v1/",s,{headers:{"Content-Type":"application/json"},withCredentials:!0});console.log("Ticket Detail Response:",e.data),n.value=e.data||{},y.value=!0}catch(s){console.error("Failed to fetch ticket detail:",s)}},b=async()=>{if(!c.value.trim()){alert("Please type a reply message.");return}try{const a=JSON.stringify({gateway_action:"customer/support",action:"reply",version:"1",id_customer:u.loginData.id_customer,ticket_id:n.value.ticket_id,message:c.value,image:""}),s=await x.post("https://gateway.streetstylestore.com/gateway/v1/",a,{headers:{"Content-Type":"application/json"},withCredentials:!0});console.log("Reply Response:",s.data),alert("Reply sent successfully!"),g(n.value.ticket_id),c.value=""}catch(a){console.error("Failed to send reply:",a),alert("Failed to send reply. Please try again.")}},f=()=>{y.value=!1,n.value={}};return w(()=>{v()}),(a,s)=>(r(),o("div",F,[s[2]||(s[2]=t("h1",{class:"text-2xl sm:text-3xl font-extrabold text-black text-center mb-6"}," Support Tickets ",-1)),p.value?(r(),o("div",M," Loading tickets... ")):i.value.length===0?(r(),o("div",V,[...s[1]||(s[1]=[t("p",{class:"text-gray-700 text-base font-medium"}," You have no support tickets yet 🛠️ ",-1),t("p",{class:"text-gray-500 text-sm"}," Need help? Raise a ticket and we'll assist you promptly. ",-1)])])):(r(),o("div",B,[(r(!0),o(m,null,_(i.value,e=>(r(),o("div",{key:e.ticket_id,class:"border border-gray-300 rounded-xl p-4 hover:shadow-md transition cursor-pointer bg-white",onClick:H=>g(e.ticket_id)},[t("div",O,[t("h2",q,"#"+l(e.ticket_id)+" - "+l(e.subject),1),t("span",{class:h(["text-xs px-2 py-1 rounded-full",e.status==="open"?"bg-green-500 text-white":"bg-gray-400 text-white"])},l(e.status),3)]),t("p",z,"Created: "+l(e.created_at),1)],8,J))),128))])),C(S,{name:"fade-scale"},{default:T(()=>[y.value?(r(),o("div",L,[t("div",A,[t("h2",E," Ticket #"+l(n.value.ticket_id)+" - "+l(n.value.subject),1),t("p",P,"Status: "+l(n.value.status),1),t("div",U,[(r(!0),o(m,null,_(n.value.messages,e=>(r(),o("div",{key:e.id,class:h(["p-3 rounded-xl",e.sender==="customer"?"bg-gray-100 text-black":"bg-black text-white"])},[t("p",I,l(e.message),1),t("p",Y,l(e.date),1)],2))),128))]),j(t("textarea",{"onUpdate:modelValue":s[0]||(s[0]=e=>c.value=e),placeholder:"Type your reply...",class:"w-full border border-gray-300 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent mb-4 resize-none",rows:"4"},null,512),[[R,c.value]]),t("div",{class:"flex justify-end gap-3"},[t("button",{onClick:b,class:"px-4 py-2 bg-black text-white rounded-xl hover:bg-gray-800 transition"}," Send Reply "),t("button",{onClick:f,class:"px-4 py-2 bg-gray-200 rounded-xl hover:bg-gray-300 transition"}," Close ")])])])):D("",!0)]),_:1})]))}},W=k($,[["__scopeId","data-v-db6308f6"]]);export{W as default};
